## Lab Description :

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/4fadad00-d4ca-40a9-b155-e0e5c619857c)

#### Exploiting XXE to retrieve files

To perform an XXE injection attack that retrieves an arbitrary file from the server's filesystem, you need to modify the submitted XML in two ways:

- Introduce (or edit) a **DOCTYPE element that defines an external entity** containing the path to the file.
- **Edit a data value in the XML that is returned in the application's response**, to make use of the defined external entity.

For example, suppose a shopping application checks for the stock level of a product by submitting the following XML to the server:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck><productId>381</productId></stockCheck>
```

The application performs no particular defenses against XXE attacks, so you can exploit the XXE vulnerability to retrieve the `/etc/passwd` file by submitting the following XXE payload:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck><productId>&xxe;</productId></stockCheck>
```
## Solution :

> Visit a product page, click "Check stock", and intercept the resulting POST request in Burp Suite.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/5046ff34-f5bd-447e-97d5-8fb249ab84ac)

Send the request to repeater.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/436ace3c-d39c-4662-80c1-7e21ef564454)

Insert the following external entity definition in between the XML declaration and the `stockCheck` element:

```xml
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
```

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/0cfcf7fb-77c2-4f6a-a90e-c4100a510278)


Replace the productId number with a reference to the external entity: 

```xml
&xxe;
```

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/d4a651d7-527a-415c-9bac-d7a8eada6f56)

The response should contain `"Invalid product ID:"` followed by the contents of the `/etc/passwd` file.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/176b5c13-00ab-4362-ab13-d3259d9a89e9)

Lab Solved.

![image](https://github.com/ananthan05/Portswigger_labs/assets/140697378/f018169b-519c-4e05-826a-82cba31cb52a)
